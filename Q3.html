<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Scheduling Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* --- FUTURISTIC DARK THEME & CUSTOM STYLES --- */
        :root {
            --primary-glow: #00ffff; /* Cyan */
            --secondary-glow: #a0a0a0;
            --success-glow: #00ff7f; /* Bright Green */
            --danger-glow: #ff0055;  /* Hot Pink/Red */
            --info-glow: #8b5cf6; /* Purple */
            
            --bg-dark-primary: #0a0f1a;
            --bg-dark-secondary: #101829;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: rgba(0, 255, 255, 0.3);
            
            --glow-shadow: 0 0 8px var(--primary-glow);
            --text-glow: 0 0 5px var(--primary-glow);
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--bg-dark-primary);
            color: var(--text-primary);
        }
        
        h1, h2, h3, h4 {
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        h1 { color: var(--primary-glow); text-shadow: var(--text-glow); }
        h2 { color: var(--text-primary); }
        h3, h4 { color: var(--text-secondary); }

        /* Main panels styling */
        .panel {
            background-color: var(--bg-dark-secondary);
            border: 1px solid var(--border-color);
            box-shadow: inset 0 0 15px rgba(0, 255, 255, 0.1);
        }
        
        /* Form elements styling */
        input[type="number"], select {
            background-color: var(--bg-dark-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-glow);
            box-shadow: var(--glow-shadow);
        }

        /* Custom radio button group */
        input[type="radio"]:checked + label {
            background-color: var(--primary-glow);
            color: var(--bg-dark-primary);
            border-color: var(--primary-glow);
            box-shadow: var(--glow-shadow);
            z-index: 10;
        }

        /* Table styling */
        thead { background-color: rgba(0, 255, 255, 0.1); }
        th { color: var(--primary-glow) !important; }

        /* Gantt Chart */
        .gantt-chart-container {
            display: flex;
            height: 50px;
            width: 100%;
            background-color: var(--bg-dark-primary);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .gantt-block {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: var(--bg-dark-primary);
            font-weight: 700;
            font-size: 0.875rem;
            position: relative;
            border-right: 1px solid rgba(10, 15, 26, 0.5);
            text-shadow: none;
        }
        .gantt-block:last-child {
            border-right: none;
        }
        .gantt-time {
            position: absolute;
            bottom: -20px;
            right: -5px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        .gantt-start-time {
            position: absolute;
            bottom: -20px;
            left: -5px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body class="text-gray-200">

<div class="container mx-auto p-4 md:p-8 max-w-7xl">
    <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold">CPU Scheduling Simulator</h1>
        <p class="text-md text-gray-400 mt-2">Visualize Preemptive and Non-Preemptive Scheduling Algorithms</p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-1 p-6 panel">
            <h2 class="text-xl font-semibold mb-4 border-b border-[--border-color] pb-2">Configuration</h2>

            <form id="add-process-form" class="space-y-4 mb-6">
                <h3 class="text-lg font-medium">Add New Process</h3>
                <div>
                    <label for="arrival-time" class="block text-sm font-medium text-gray-400">Arrival Time</label>
                    <input type="number" id="arrival-time" min="0" value="0" class="mt-1 block w-full px-3 py-2 shadow-sm focus:outline-none sm:text-sm">
                </div>
                <div>
                    <label for="burst-time" class="block text-sm font-medium text-gray-400">Burst Time</label>
                    <input type="number" id="burst-time" min="1" value="1" class="mt-1 block w-full px-3 py-2 shadow-sm focus:outline-none sm:text-sm">
                </div>
                <button type="submit" class="w-full bg-[--primary-glow] text-[--bg-dark-primary] font-semibold py-2 px-4 hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[--bg-dark-primary] focus:ring-[--primary-glow] transition duration-150 ease-in-out">
                    Add Process
                </button>
            </form>

            <div class="mb-6">
                <h3 class="block text-lg font-medium">Scheduling Type</h3>
                <div class="mt-2 flex shadow-sm">
                    <div class="relative flex items-stretch flex-grow focus-within:z-10">
                        <input type="radio" name="scheduling-type" id="non-preemptive" value="non-preemptive" class="hidden" checked>
                        <label for="non-preemptive" class="w-full text-center cursor-pointer border border-[--border-color] bg-[--bg-dark-primary] p-2">Non-Preemptive</label>
                    </div>
                    <div class="relative flex items-stretch flex-grow focus-within:z-10 -ml-px">
                        <input type="radio" name="scheduling-type" id="preemptive" value="preemptive" class="hidden">
                        <label for="preemptive" class="w-full text-center cursor-pointer border border-[--border-color] bg-[--bg-dark-primary] p-2">Preemptive</label>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 for="algorithm-select" class="block text-lg font-medium">Select Algorithm</h3>
                <select id="algorithm-select" class="mt-1 block w-full px-3 py-2 shadow-sm focus:outline-none sm:text-sm">
                    </select>
            </div>

            <div id="time-quantum-container" class="mb-6 hidden">
                <h3 for="time-quantum" class="block text-lg font-medium">Time Quantum</h3>
                <input type="number" id="time-quantum" min="1" value="2" class="mt-1 block w-full px-3 py-2 shadow-sm focus:outline-none sm:text-sm">
            </div>

            <div class="flex space-x-4">
                <button id="run-simulation" class="flex-1 bg-[--success-glow] text-[--bg-dark-primary] font-semibold py-2 px-4 hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[--bg-dark-primary] focus:ring-[--success-glow] transition duration-150 ease-in-out">
                    Run Simulation
                </button>
                <button id="reset-simulation" class="flex-1 bg-[--danger-glow] text-white font-semibold py-2 px-4 hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[--bg-dark-primary] focus:ring-[--danger-glow] transition duration-150 ease-in-out">
                    Reset
                </button>
            </div>
        </div>

        <div class="lg:col-span-2 p-6 panel">
            <div>
                <h2 class="text-xl font-semibold mb-4">Process List</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-[--border-color]">
                        <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Process ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Arrival Time</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Burst Time</th>
                        </tr>
                        </thead>
                        <tbody id="process-table-body" class="divide-y divide-[--border-color]">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="results-container" class="mt-8 opacity-0 transition-opacity duration-500">
                <h2 class="text-xl font-semibold mb-4">Results</h2>
                <div>
                    <h3 class="text-lg font-medium mb-2">Gantt Chart</h3>
                    <div class="relative pt-4">
                        <div id="gantt-chart" class="gantt-chart-container"></div>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                    <div class="bg-[rgba(0,255,255,0.1)] p-4 border border-[--border-color]">
                        <h4 class="text-sm font-semibold text-[--primary-glow]">Average Waiting Time</h4>
                        <p id="avg-waiting-time" class="text-2xl font-bold text-white">0.00</p>
                    </div>
                    <div class="bg-[rgba(139,92,246,0.1)] p-4 border border-[--info-glow]">
                        <h4 class="text-sm font-semibold text-[--info-glow]">Average Turnaround Time</h4>
                        <p id="avg-turnaround-time" class="text-2xl font-bold text-white">0.00</p>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="text-lg font-medium mb-2">Detailed Results</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-[--border-color]">
                            <thead>
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Process ID</th>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Arrival</th>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Burst</th>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Completion</th>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Turnaround</th>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Waiting</th>
                            </tr>
                            </thead>
                            <tbody id="results-table-body" class="divide-y divide-[--border-color]">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    // DOM Elements
    const addProcessForm = document.getElementById('add-process-form');
    const arrivalTimeInput = document.getElementById('arrival-time');
    const burstTimeInput = document.getElementById('burst-time');
    const processTableBody = document.getElementById('process-table-body');

    const schedulingTypeRadios = document.querySelectorAll('input[name="scheduling-type"]');
    const algorithmSelect = document.getElementById('algorithm-select');
    const timeQuantumContainer = document.getElementById('time-quantum-container');
    const timeQuantumInput = document.getElementById('time-quantum');

    const runBtn = document.getElementById('run-simulation');
    const resetBtn = document.getElementById('reset-simulation');

    // Results Elements
    const resultsContainer = document.getElementById('results-container');
    const ganttChart = document.getElementById('gantt-chart');
    const avgWaitingTimeEl = document.getElementById('avg-waiting-time');
    const avgTurnaroundTimeEl = document.getElementById('avg-turnaround-time');
    const resultsTableBody = document.getElementById('results-table-body');

    let processes = [];
    let processIdCounter = 1;

    const algorithms = {
        'non-preemptive': [
            { value: 'fcfs', text: 'First-Come, First-Serve (FCFS)' },
            { value: 'sjf', text: 'Shortest Job First (SJF - Non-Preemptive)' }
        ],
        'preemptive': [
            { value: 'srtf', text: 'Shortest Remaining Time First (SRTF)' },
            { value: 'rr', text: 'Round Robin (RR)' }
        ]
    };

    // Color palette for Gantt chart blocks (Updated for dark theme)
    const colors = [
        '#3b82f6', '#8b5cf6', '#10b981', '#ef4444', '#f97316',
        '#22d3ee', '#ec4899', '#6366f1', '#14b8a6', '#d946ef'
    ];

    // --- UI LOGIC ---

    function updateAlgorithmOptions() {
        const selectedType = document.querySelector('input[name="scheduling-type"]:checked').value;
        algorithmSelect.innerHTML = '';
        algorithms[selectedType].forEach(algo => {
            const option = document.createElement('option');
            option.value = algo.value;
            option.textContent = algo.text;
            algorithmSelect.appendChild(option);
        });
        // Trigger change to update visibility of time quantum
        algorithmSelect.dispatchEvent(new Event('change'));
    }

    schedulingTypeRadios.forEach(radio => {
        radio.addEventListener('change', updateAlgorithmOptions);
    });

    algorithmSelect.addEventListener('change', () => {
        if (algorithmSelect.value === 'rr') {
            timeQuantumContainer.classList.remove('hidden');
        } else {
            timeQuantumContainer.classList.add('hidden');
        }
    });

    // --- CORE LOGIC ---

    function addSampleProcesses() {
        const sampleData = [
            { arrival: 0, burst: 8 }, { arrival: 1, burst: 4 },
            { arrival: 2, burst: 9 }, { arrival: 3, burst: 5 },
        ];
        sampleData.forEach(p => addProcess(p.arrival, p.burst));
    }

    function addProcess(arrivalTime, burstTime) {
        const process = {
            id: processIdCounter++, arrivalTime: parseInt(arrivalTime),
            burstTime: parseInt(burstTime)
        };
        processes.push(process);
        renderProcessTable();
    }

    function renderProcessTable() {
        processTableBody.innerHTML = '';
        if (processes.length === 0) {
            processTableBody.innerHTML = `<tr><td colspan="3" class="text-center py-4 text-gray-500">No processes added.</td></tr>`;
        } else {
            processes.forEach(p => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap">P${p.id}</td>
                         <td class="px-6 py-4 whitespace-nowrap">${p.arrivalTime}</td>
                         <td class="px-6 py-4 whitespace-nowrap">${p.burstTime}</td>`;
                processTableBody.appendChild(row);
            });
        }
    }

    addProcessForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const arrivalTime = arrivalTimeInput.value;
        const burstTime = burstTimeInput.value;
        if (burstTime > 0) {
            addProcess(arrivalTime, burstTime);
            arrivalTimeInput.value = parseInt(arrivalTime) + 1;
            burstTimeInput.value = Math.floor(Math.random() * 10) + 1;
            arrivalTimeInput.focus();
        } else {
            alert("Burst time must be greater than 0.");
        }
    });

    runBtn.addEventListener('click', () => {
        if (processes.length === 0) {
            alert("Please add at least one process."); return;
        }
        const algorithm = algorithmSelect.value;
        let results;
        switch (algorithm) {
            case 'fcfs': results = runFCFS(); break;
            case 'sjf': results = runSJF(); break;
            case 'srtf': results = runSRTF(); break;
            case 'rr': results = runRR(); break;
        }
        if (results) displayResults(results);
    });

    resetBtn.addEventListener('click', () => {
        processes = []; processIdCounter = 1;
        renderProcessTable();
        resultsContainer.classList.add('opacity-0');
    });

    // --- ALGORITHMS ---

    function runFCFS() {
        const sortedProcesses = [...processes].sort((a, b) => a.arrivalTime - b.arrivalTime || a.id - b.id);
        let currentTime = 0; let ganttData = [];
        sortedProcesses.forEach(p => {
            if (currentTime < p.arrivalTime) {
                ganttData.push({ id: 'Idle', start: currentTime, end: p.arrivalTime });
                currentTime = p.arrivalTime;
            }
            p.completionTime = currentTime + p.burstTime;
            p.turnaroundTime = p.completionTime - p.arrivalTime;
            p.waitingTime = p.turnaroundTime - p.burstTime;
            ganttData.push({ id: p.id, start: currentTime, end: p.completionTime });
            currentTime = p.completionTime;
        });
        return { processes: sortedProcesses, ganttData };
    }

    function runSJF() {
        let tempProcesses = JSON.parse(JSON.stringify(processes));
        tempProcesses.sort((a, b) => a.arrivalTime - b.arrivalTime || a.id - b.id);
        let completedProcesses = []; let ganttData = [];
        let currentTime = 0; let readyQueue = [];
        while (tempProcesses.length > 0 || readyQueue.length > 0) {
            while (tempProcesses.length > 0 && tempProcesses[0].arrivalTime <= currentTime) {
                readyQueue.push(tempProcesses.shift());
            }
            readyQueue.sort((a, b) => a.burstTime - b.burstTime || a.arrivalTime - b.arrivalTime || a.id - b.id);
            if (readyQueue.length === 0) {
                if(tempProcesses.length > 0) {
                    ganttData.push({ id: 'Idle', start: currentTime, end: tempProcesses[0].arrivalTime });
                    currentTime = tempProcesses[0].arrivalTime;
                }
            } else {
                const currentProcess = readyQueue.shift();
                currentProcess.completionTime = currentTime + currentProcess.burstTime;
                currentProcess.turnaroundTime = currentProcess.completionTime - currentProcess.arrivalTime;
                currentProcess.waitingTime = currentProcess.turnaroundTime - currentProcess.burstTime;
                ganttData.push({ id: currentProcess.id, start: currentTime, end: currentProcess.completionTime });
                currentTime = currentProcess.completionTime;
                completedProcesses.push(currentProcess);
            }
        }
        return { processes: completedProcesses, ganttData };
    }

    function runSRTF() {
        let tempProcesses = JSON.parse(JSON.stringify(processes));
        tempProcesses.forEach(p => p.remainingTime = p.burstTime);
        let completedProcesses = []; let ganttData = [];
        let currentTime = 0;
        const totalProcesses = tempProcesses.length;

        while (completedProcesses.length < totalProcesses) {
            const readyQueue = tempProcesses.filter(p => p.arrivalTime <= currentTime && p.remainingTime > 0);
            if (readyQueue.length === 0) {
                const nextArrival = Math.min(...tempProcesses.filter(p=>p.remainingTime > 0).map(p => p.arrivalTime));
                if(nextArrival > currentTime) {
                    ganttData.push({ id: 'Idle', start: currentTime, end: nextArrival });
                    currentTime = nextArrival;
                }
                continue;
            }
            readyQueue.sort((a, b) => a.remainingTime - b.remainingTime || a.arrivalTime - b.arrivalTime || a.id - b.id);
            const currentProcess = readyQueue[0];
            const startTime = currentTime;
            currentTime++;
            currentProcess.remainingTime--;
            ganttData.push({ id: currentProcess.id, start: startTime, end: currentTime });

            if (currentProcess.remainingTime === 0) {
                currentProcess.completionTime = currentTime;
                currentProcess.turnaroundTime = currentProcess.completionTime - currentProcess.arrivalTime;
                currentProcess.waitingTime = currentProcess.turnaroundTime - currentProcess.burstTime;
                completedProcesses.push(currentProcess);
            }
        }
        return { processes: completedProcesses, ganttData: consolidateGanttData(ganttData) };
    }

    function runRR() {
        const timeQuantum = parseInt(timeQuantumInput.value);
        if (isNaN(timeQuantum) || timeQuantum <= 0) {
            alert("Please enter a valid Time Quantum greater than 0.");
            return;
        }
        let tempProcesses = JSON.parse(JSON.stringify(processes));
        tempProcesses.sort((a,b) => a.arrivalTime - b.arrivalTime || a.id - b.id);
        tempProcesses.forEach(p => p.remainingTime = p.burstTime);
        let completedProcesses = []; let ganttData = [];
        let currentTime = 0; let readyQueue = [];
        let processQueue = [...tempProcesses];

        while (processQueue.length > 0 || readyQueue.length > 0) {
            while(processQueue.length > 0 && processQueue[0].arrivalTime <= currentTime) {
                readyQueue.push(processQueue.shift());
            }
            if (readyQueue.length === 0) {
                if (processQueue.length > 0) {
                    const nextArrival = processQueue[0].arrivalTime;
                    ganttData.push({ id: 'Idle', start: currentTime, end: nextArrival });
                    currentTime = nextArrival;
                }
                continue;
            }
            const currentProcess = readyQueue.shift();
            const executionTime = Math.min(timeQuantum, currentProcess.remainingTime);
            ganttData.push({ id: currentProcess.id, start: currentTime, end: currentTime + executionTime });
            currentTime += executionTime;
            currentProcess.remainingTime -= executionTime;

            while(processQueue.length > 0 && processQueue[0].arrivalTime <= currentTime) {
                readyQueue.push(processQueue.shift());
            }
            if (currentProcess.remainingTime > 0) {
                readyQueue.push(currentProcess);
            } else {
                currentProcess.completionTime = currentTime;
                currentProcess.turnaroundTime = currentProcess.completionTime - currentProcess.arrivalTime;
                currentProcess.waitingTime = currentProcess.turnaroundTime - currentProcess.burstTime;
                completedProcesses.push(currentProcess);
            }
        }
        return { processes: completedProcesses, ganttData: consolidateGanttData(ganttData) };
    }

    // --- RESULTS DISPLAY ---

    function displayResults({ processes, ganttData }) {
        const totalWaitingTime = processes.reduce((acc, p) => acc + p.waitingTime, 0);
        const totalTurnaroundTime = processes.reduce((acc, p) => acc + p.turnaroundTime, 0);
        avgWaitingTimeEl.textContent = (totalWaitingTime / processes.length).toFixed(2);
        avgTurnaroundTimeEl.textContent = (totalTurnaroundTime / processes.length).toFixed(2);
        renderGanttChart(ganttData);
        renderResultsTable(processes);
        resultsContainer.classList.remove('opacity-0');
    }

    function consolidateGanttData(ganttData) {
        if (ganttData.length === 0) return [];
        const consolidated = [ganttData[0]];
        for (let i = 1; i < ganttData.length; i++) {
            const lastEntry = consolidated[consolidated.length - 1];
            const currentEntry = ganttData[i];
            if (currentEntry.id === lastEntry.id) {
                lastEntry.end = currentEntry.end;
            } else {
                consolidated.push(currentEntry);
            }
        }
        return consolidated;
    }

    function renderGanttChart(ganttData) {
        ganttChart.innerHTML = '';
        if (ganttData.length === 0) return;
        const totalDuration = ganttData[ganttData.length - 1].end;
        ganttChart.innerHTML += `<span class="gantt-start-time">0</span>`;
        ganttData.forEach(item => {
            const block = document.createElement('div');
            const duration = item.end - item.start;
            const widthPercentage = (duration / totalDuration) * 100;
            block.className = 'gantt-block';
            block.style.width = `${widthPercentage}%`;
            if (item.id === 'Idle') {
                block.style.backgroundColor = '#4b5563'; // gray-600
                block.textContent = 'Idle';
                block.classList.add('italic');
                block.style.color = '#d1d5db'; // gray-300
            } else {
                block.style.backgroundColor = colors[(item.id - 1) % colors.length];
                block.textContent = `P${item.id}`;
            }
            block.innerHTML += `<span class="gantt-time">${item.end}</span>`;
            ganttChart.appendChild(block);
        });
    }

    function renderResultsTable(completedProcesses) {
        resultsTableBody.innerHTML = '';
        completedProcesses.sort((a,b) => a.id - b.id).forEach(p => {
            const row = document.createElement('tr');
            row.innerHTML = `<td class="px-4 py-3 whitespace-nowrap">P${p.id}</td>
                       <td class="px-4 py-3 whitespace-nowrap">${p.arrivalTime}</td>
                       <td class="px-4 py-3 whitespace-nowrap">${p.burstTime}</td>
                       <td class="px-4 py-3 whitespace-nowrap">${p.completionTime}</td>
                       <td class="px-4 py-3 whitespace-nowrap">${p.turnaroundTime}</td>
                       <td class="px-4 py-3 whitespace-nowrap">${p.waitingTime}</td>`;
            resultsTableBody.appendChild(row);
        });
    }

    // --- INITIAL SETUP ---
    updateAlgorithmOptions();
    addSampleProcesses();
    renderProcessTable();
});
</script>
</body>
</html>